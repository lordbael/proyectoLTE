<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Tutorial 15</title>
    <script src='mqttws31.js' type='text/javascript'></script>
    <!-- https://api.cloudmqtt.com/sso/js/mqttws31.js -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.4/raphael-min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.2.9/justgage.min.js"></script>
    <script src="raphael-2.1.4.min.js"></script>
    <script src="justgage.js"></script>
    
  </head>
  
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <section class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1>ChartJS</h1>
            </div>
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active">JSChart</li>
              </ol>
            </div>
          </div>
        </div><!-- /.container-fluid -->
      </section>
    
      <!-- Main content -->
      <section class="content">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-6">
              <!-- AREA CHART -->
              <div class="card card-primary">
                <div class="card-header">
                  <h3 class="card-title">Area Chart</h3>
    
                  <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                      <i class="fas fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-tool" data-card-widget="remove">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
                <div class="card-body">
                  <div class="chart">
                    <ngx-charts-advanced-pie-chart
                          [view]="view"
                          scheme="cool"
                          [results]="single"
                          [gradient]="gradient"
                          (select)="onSelect($event)"
                          (activate)="onActivate($event)"
                          (deactivate)="onDeactivate($event)"
                          >
                      </ngx-charts-advanced-pie-chart>
                  </div>
                </div>
                <!-- /.card-body -->
              </div>
              <!-- /.card -->
    
              <!-- DONUT CHART -->
              <div class="card card-danger">
                <div class="card-header">
                  <h3 class="card-title">Vertical Chart</h3>
    
                  <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                      <i class="fas fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-tool" data-card-widget="remove">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
                <div class="card-body">
                  <ngx-charts-bar-vertical
                    [view]="view2"
                    scheme="fire"
                    [results]="single"
                    [gradient]="gradient2"
                    [xAxis]="showXAxis"
                    [yAxis]="showYAxis"
                    [legend]="showLegend2"
                    [showXAxisLabel]="showXAxisLabel"
                    [showYAxisLabel]="showYAxisLabel"
                    [xAxisLabel]="xAxisLabel"
                    [yAxisLabel]="yAxisLabel"
                    (select)="onSelect($event)">
                  </ngx-charts-bar-vertical>
                </div>
                <!-- /.card-body -->
              </div>
              <!-- /.card -->
            </div>
            <!-- /.col (LEFT) -->
            <div class="col-md-6">
              <!-- LINE CHART -->
              <div class="card card-info">
                <div class="card-header">
                  <h3 class="card-title">Line Chart</h3>
    
                  <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                      <i class="fas fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-tool" data-card-widget="remove">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
                <div class="card-body">
                  <div class="chart">
                    <ngx-charts-bar-horizontal
                      [view]="view3"
                      scheme="night"
                      [results]="single"
                      [gradient]="gradient"
                      [xAxis]="showXAxis3"
                      [yAxis]="showYAxis3"
                      [legend]="showLegend3"
                      [showXAxisLabel]="showXAxisLabel3"
                      [showYAxisLabel]="showYAxisLabel3"
                      [xAxisLabel]="xAxisLabel3"
                      [yAxisLabel]="yAxisLabel3"
                      (select)="onSelect($event)"
                      (activate)="onActivate($event)"
                      (deactivate)="onDeactivate($event)">
                  </ngx-charts-bar-horizontal>
                  </div>
                </div>
                <!-- /.card-body -->
              </div>
              <!-- /.card -->
    
              <!-- BAR CHART -->
              <div class="card card-success">
                <div class="card-header">
                  <h3 class="card-title">Area Chart</h3>
    
                  <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse">
                      <i class="fas fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-tool" data-card-widget="remove">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>
                <div class="card-body">
                  <div class="chart">
                    <ngx-charts-area-chart
                      [view]="view4"
                      scheme="air"
                      [legend]="legend"
                      [showXAxisLabel]="showXAxisLabel4"
                      [showYAxisLabel]="showYAxisLabel4"
                      [xAxis]="xAxis"
                      [yAxis]="yAxis"
                      [xAxisLabel]="xAxisLabel4"
                      [yAxisLabel]="yAxisLabel4"
                      [timeline]="timeline"
                      [results]="multi"
                      (select)="onSelect($event)">
                    </ngx-charts-area-chart>
                  </div>
                </div>
                <!-- /.card-body -->
              </div>
              <!-- /.card -->
    
            </div>
            <!-- /.col (RIGHT) -->
          </div>
          <!-- /.row -->
        </div><!-- /.container-fluid -->
      </section>
      <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
  
  
  
  
  
  
  
    <!-- ESPACIO DE MAQUETADO -->
    <div class="container">
  
      <div class="content-wrapper center">
  
        
      <style type="text/css">
          .a200x160px {
              width: 200px;
              height: 160px;
          }
    
          img {
              margin-left: 75px;
          }
      
          .switch {
              position: relative;
              display: inline-block;
              width: 120px;
              height: 68px;
          }
      
          .switch input {
              display: none;
          }
      
          .slider {
              position: absolute;
              cursor: pointer;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background-color: #ccc;
              -webkit-transition: .4s;
              transition: .4s;
          }
      
          .slider:before {
              position: absolute;
              content: "";
              height: 52px;
              width: 52px;
              left: 8px;
              bottom: 8px;
              background-color: white;
              -webkit-transition: .4s;
              transition: .4s;
          }
      
          input:checked+.slider {
              background-color: red;
          }
      
          input:focus+.slider {
              box-shadow: 0 0 1px #2196F3;
          }
      
          input:checked+.slider:before {
              -webkit-transform: translateX(52px);
              -ms-transform: translateX(52px);
              transform: translateX(52px);
          }
      
          .slider.round {
              border-radius: 68px;
          }
      
          .slider.round:before {
              border-radius: 50%;
          }
      
          input[type=range] {
              height: 26px;
              -webkit-appearance: none;
              margin: 10px 0;
              width: 120px;
          }
      
          input[type=range]:focus {
              outline: none;
          }
      
          input[type=range]::-webkit-slider-runnable-track {
              width: 100%;
              height: 14px;
              cursor: pointer;
              animate: 0.2s;
              box-shadow: 1px 1px 1px #50555C;
              background: #50555C;
              border-radius: 14px;
              border: 0px solid #000000;
          }
      
          input[type=range]::-webkit-slider-thumb {
              box-shadow: 0px 0px 0px #000000;
              border: 0px solid #000000;
              height: 20px;
              width: 40px;
              border-radius: 12px;
              background: green;
              cursor: pointer;
              -webkit-appearance: none;
              margin-top: -3px;
          }
      
          input[type=range]:focus::-webkit-slider-runnable-track {
              background: #50555C;
          }
      
          input[type=range]:focus::-ms-fill-lower {
              background: #50555C;
          }
      
          input[type=range]:focus::-ms-fill-upper {
              background: #50555C;
          }
      </style>
      
      <body>
          <div id="gauge" class="a200x160px"></div>
          <div>
              <img id="imgPulsador" src="https://cdn-icons-png.flaticon.com/512/1612/1612636.png" width="80px">
          </div>
          <br>
          <div>
              <svg width="100" height="75" viewBox="0 0 640 480">
                  <defs>
                      <linearGradient id="svg_6" x1="0" y1="0" x2="1" y2="0">
                          <stop stop-color="#bfbfbf" offset="0" />
                          <stop stop-color="#404040" offset="1" />
                      </linearGradient>
                      <linearGradient id="svg_11" x1="0" y1="0" x2="1" y2="1" spreadMethod="pad">
                          <stop id="led1" stop-color="#000000" stop-opacity="0.992188" offset="0" />
                          <stop stop-color="#820101" stop-opacity="0.988281" offset="1" />
                      </linearGradient>
                      <linearGradient id="svg_14" x1="0" y1="0" x2="1" y2="1" spreadMethod="pad">
                          <stop stop-color="#ffffff" stop-opacity="0.996094" offset="0" />
                          <stop stop-color="#d30606" stop-opacity="0.984375" offset="0.703125" />
                      </linearGradient>
                  </defs>
                  <g>
                      <title>Layer 1</title>
                      <circle fill="url(#svg_6)" stroke-width="17.5" stroke-linecap="round" cx="320" cy="240" r="196.125"
                          id="svg_3" fill-opacity="0.77" transform="rotate(90, 320, 240)" />
                      <circle fill="url(#svg_6)" stroke-width="17.5" stroke-linecap="round" fill-opacity="0.64"
                          cx="319.252837" cy="239.999045" r="160" id="svg_7" />
                      <circle fill="url(#svg_11)" stroke-width="17.5" stroke-linecap="round" cx="320.000535" cy="240.001698"
                          r="150" id="svg_8" />
                      <ellipse fill="url(#svg_14)" stroke-width="17.5" stroke-linecap="round" cx="250.179609" cy="170.124194"
                          rx="75.675959" ry="44.402987" id="svg_20" transform="rotate(-47.7626, 250.18, 170.125)" />
                  </g>
              </svg>
              <label class="switch">
                  <input type="checkbox" onclick='OnOff2()'>
                  <span class="slider round"></span>
              </label>
          </div>
          <div>
              <svg width="100" height="75" viewBox="0 0 640 480">
                  <defs>
                      <linearGradient id="svg_26" x1="0" y1="0" x2="1" y2="0">
                          <stop stop-color="#bfbfbf" offset="0" />
                          <stop stop-color="#404040" offset="1" />
                      </linearGradient>
                      <linearGradient id="svg_211" x1="0" y1="0" x2="1" y2="1" spreadMethod="pad">
                          <stop id="led2" stop-color="rgb(0, 0, 0)" stop-opacity="0.992188" offset="0" />
                          <stop stop-color="#018201" stop-opacity="0.988281" offset="1" />
                      </linearGradient>
                      <linearGradient id="svg_214" x1="0" y1="0" x2="1" y2="1" spreadMethod="pad">
                          <stop stop-color="#ffffff" stop-opacity="0.996094" offset="0" />
                          <stop stop-color="#06d306" stop-opacity="0.984375" offset="0.703125" />
                      </linearGradient>
                  </defs>
                  <g>
                      <title>Layer 1</title>
                      <circle fill="url(#svg_6)" stroke-width="17.5" stroke-linecap="round" cx="320" cy="240" r="196.125"
                          id="svg_23" fill-opacity="0.77" transform="rotate(90, 320, 240)" />
                      <circle fill="url(#svg_6)" stroke-width="17.5" stroke-linecap="round" fill-opacity="0.64"
                          cx="319.252837" cy="239.999045" r="160" id="svg_27" />
                      <circle fill="url(#svg_211)" stroke-width="17.5" stroke-linecap="round" cx="320.000535" cy="240.001698"
                          r="150" id="svg_28" />
                      <ellipse fill="url(#svg_214)" stroke-width="17.5" stroke-linecap="round" cx="250.179609" cy="170.124194"
                          rx="75.675959" ry="44.402987" id="svg_220" transform="rotate(-47.7626, 250.18, 170.125)" />
                  </g>
              </svg>
              <input type="range" id="myRange" min="0" max="1023" onmouseup="enviarSalidaAnalogica()">
          </div>
          <script>
              usuario = 'placa2';
              contrasena = '12345678';
      
              var g = new JustGage({
                  id: "gauge",
                  min: 0,
                  max: 50,
                  title: "Temperatura ºC"
              });

              
      
              estadoDigital = "OFF";
      
              function OnOff2() {
                  if (estadoDigital == "OFF") {
                      message = new Paho.MQTT.Message("ON");
                      message.destinationName = '/' + usuario + '/salidaDigital'
                      client.send(message);
                  }
                  else if (estadoDigital == "ON") {
                      message = new Paho.MQTT.Message("OFF");
                      message.destinationName = '/' + usuario + '/salidaDigital'
                      client.send(message);
                  }
              };
      
              function enviarSalidaAnalogica() {
                  var dato = document.getElementById("myRange").value;
                  message = new Paho.MQTT.Message(dato);
                  message.destinationName = '/' + usuario + '/salidaAnalogica'
                  client.send(message);
              };
      
              // called when the client connects
              function onConnect() {
                  // Once a connection has been made, make a subscription and send a message.
                  console.log("onConnect");
                  client.subscribe("#");
              }
      
              // called when the client loses its connection
              function onConnectionLost(responseObject) {
                  if (responseObject.errorCode !== 0) {
                      console.log("onConnectionLost:", responseObject.errorMessage);
                      setTimeout(function () { client.connect() }, 5000);
                  }
              }
      
              // called when a message arrives
              function onMessageArrived(message) {
                  if (message.destinationName == '/' + usuario + '/' + 'temperatura') { //acá coloco el topic
                      //document.getElementById("temperatura").textContent = message.payloadString  + " ºC";
                      g.refresh(message.payloadString);
                  }
                  if (message.destinationName == '/' + usuario + '/' + 'pulsador') { //acá coloco el topic
                      //document.getElementById("pulsador").textContent = message.payloadString;
                      if (message.payloadString == "presionado") {
                          document.getElementById("imgPulsador").src = "https://cdn-icons-png.flaticon.com/512/1612/1612744.png"
                      }
                      else if (message.payloadString == "NO presionado") {
                          document.getElementById("imgPulsador").src = "https://cdn-icons-png.flaticon.com/512/1612/1612636.png"
                      }
                  }
                  if (message.destinationName == '/' + usuario + '/' + 'salidaDigital') { //acá coloco el topic
                      //document.getElementById("salidaDigital").textContent = message.payloadString;
                      estadoDigital = message.payloadString;
      
                      if (estadoDigital == "OFF") {
                          document.getElementById("led1").setAttribute("stop-color", "#110000");
                      }
                      else if (estadoDigital == "ON") {
                          document.getElementById("led1").setAttribute("stop-color", "#ff0000");
                      }
                  }
                  if (message.destinationName == '/' + usuario + '/' + 'salidaAnalogica') { //acá coloco el topic
                      //document.getElementById("salidaAnalogica").textContent = message.payloadString;
                      document.getElementById("led2").setAttribute("stop-color", "rgb(0, " + parseInt(message.payloadString / 4) + ", 0)")
                  }
              }
      
              function onFailure(invocationContext, errorCode, errorMessage) {
                  var errDiv = document.getElementById("error");
                  errDiv.textContent = "Could not connect to WebSocket server, most likely you're behind a firewall that doesn't allow outgoing connections to port 39627";
                  errDiv.style.display = "block";
              }
      
              var clientId = "ws" + Math.random();
              // Create a client instance
              var client = new Paho.MQTT.Client("m13.cloudmqtt.com", 31948, clientId);
      
              // set callback handlers
              client.onConnectionLost = onConnectionLost;
              client.onMessageArrived = onMessageArrived;
      
              // connect the client
              client.connect({
                  useSSL: true,
                  userName: usuario,
                  password: contrasena,
                  onSuccess: onConnect,
                  onFailure: onFailure
              });        
          </script>
      </body>
    
      </div>
  
    </div>
</html>

